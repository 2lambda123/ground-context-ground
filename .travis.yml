language: java
jdk: oraclejdk8

# install Neo4j manually because Neo4j as a service doesn't work
before_install:
  - wget dist.neo4j.org/neo4j-community-3.0.6-unix.tar.gz
  - tar -xzf neo4j-community-3.0.6-unix.tar.gz
  - neo4j-community-3.0.6/bin/neo4j start
  
services:
    - postgresql
    - cassandra

before_script: 
    - createdb test
    - createuser test -d -s
    - |- 
        cqlsh -e "create keyspace test with replication = { 'class' : 'SimpleStrategy', 'replication_factor' : 1 };"
    - cd ground-core/scripts/postgres && python2.7 postgres_setup.py test test && cd ../../..
    - cd ground-core/scripts/cassandra && python2.7 cassandra_setup.py test && cd ../../..

script: mvn clean test

after_script:
    - cat /home/travis/build/ground-context/ground/neo4j-community-3.0.6/logs/neo4j.log

after_success: 
    - mvn clean test jacoco:report coveralls:report
  
